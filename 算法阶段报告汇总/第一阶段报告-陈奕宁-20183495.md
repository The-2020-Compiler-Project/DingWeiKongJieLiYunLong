### 第一阶段报告-陈奕宁-20183495

****

#### 一、工作情况

**1、文法设计过程：**

我和另外两个队友一起设计了基于C语言的主要功能的文法设计，因为不想操之过急，对于像函数调用这种语句暂时没有做处理，如果一切进展顺利，加快步伐之后，会重新考虑添加。同时，我们于7月2日傍晚，对于在第一天一起商定的文法进行了改善，因为发现了一些问题，比如复合语句子程序到声明数组变量和非数组变量的时候，会出现同产生式左部，而右部select集存在交集的情况，经过改善之后，已经完善成LL(1)文法，文法如下：

(1)<程序> --> void main (){ <复合语句> }

解释：无语义动作，只需要进行关键字和界符的判断，遇到错误当即进行抛出

(2)<复合语句> --> <类型>  1 <变量声明语句> <复合语句>

​						|| 标识符 2 <赋值语句> <复合语句>

​						|| <if语句> <复合语句> 

​						|| <while语句> <复合语句>  || 空空

解释： 1.将类型压倒语义栈中去 2.查看标识符是否已经声明，

(3)<类型> --> int || char || bool || string || double

(4)<变量声明语句> --> 标识符 <变量声明子程序>

(5) <变量声明子程序> --> <非数组型变量声明语句> ;

​									|| [整型常数] <数组型变量声明语句>

(6) <非数组型变量声明语句> --> , 标识符 <非数组型变量声明语句> 

​													|| = <表达式> ||空空

(7) <数组型变量声明语句> --> , 标识符 [算术表达式] <非数组型变量声明语句>

​												|| = { <表达式> <数组初始化> } || = <表达式> || 空空

(8) <数组初始化> --> , <表达式> <数组初始化> || 空空

(9) <赋值语句> --> <赋值语句子程序> || [ 算术表达式 ] <赋值语句子程序>

(10)<赋值语句子程序> -->  = <表达式> ;

(11)<表达式> --> 算术表达式 || 逻辑表达式 || 字符常量 || 字符串常量

(12)<逻辑表达式> --> <运算符> <算术表达式>

(13)<算术表达式> --> > || >= || < || <= || && || || ||== || != || 空空

(14)<while语句> --> while (表达式) {复合语句} 复合语句

(15)<if语句> --> if (表达式) {复合语句} <if语句子程序>

(16)<if语句子程序> --> <复合语句> || else {复合语句} <复合语句>

(15)<算术表达式> -->TE1

(16)T->FT1

(17)E1->W0(+ || -) T E1 || 空

(18)F->标识符 <B> || (算术表达式) || 常数

(19)<B>-->[算术表达式]||空空

(20)T1->W1(* || /) F T1 || 空

**2、几次课的进度汇总**（个人）：

6.29：初步设计文法，从尝试简单的文法（比如算术表达式文法）四元式翻译文法的设计开始，并进行简单文法的			四元式设计。

7.1：（1）预计完成表达式部分语义分析的实现，完成变量声明和赋值部分的中间代码生成以及对应的翻译文法编 			写，和对应填写符号表的语义动作
 		（2）文法的进一步完善（包括对整体流程的重新规范和类型的声明等）
 		（3）完成错误分析工作，即对比如已经声明好了的变量，再次声明时就进行错误抛出 

7.2：完成从词法分析扫描器到语义分析入口函数的对接，语义分析入口到下面一级递归子程序的选择以及错误分		析，完善语义动作，完善算术表达式部分文法的四元式生成。对文法的错误进行修正。

7.4：对语义分析和符号表以及词法分析的扫描器进行合并，不断调试，并进行子模块的输出测试，进行前端的整		合的初步工作。

**3、工作任务：**

独自负责语义分析模块的编写，包括生成四元式的设计和实现，错误分析，以及翻译文法设计和语义动作的编写，前端几个模块的合并调试，同时和其他二人进行文法设计。预计后端完成和队友继续进行生成汇编代码和四元式优化的合作分工。

**4、语义分析类设计：**

注：只体现已经完成编写的部分

<img src="C:\Users\Chen Yining\AppData\Roaming\Typora\typora-user-images\image-20200704001952802.png" alt="image-20200704001952802" style="zoom:50%;" />

class Semantic
{
	public:
		Token current;		//表示当前读取的Token串 
		stack<Token>Arithmeticsem;		//语义栈 
		vector<quat>QuarterList;		//语义分析得到的四元式表 
		int Arithmetic(word &pointer);		//算术表达式翻译文法
		void Print_Quat();		//四元式输出
		int Semantic_Run(word &pointer);		//语义分析入口
		int ComLex(word &pointer);		//复合语句入口 
		int Variable_Index(word &pointer);	//变量声明子程序 
		int Variable_Nameson(word &pointer);	//赋值语句子程序的子程序 
		int Variable_2(word &pointer);
		int Value_Name(word &pointer);		//赋值语句子程序 
		int if_Name(word &pointer);	//if子程序 
		int T(word &pointer);
		int E1(word &pointer);
		int F(word &pointer);
		int T1(word &pointer); 
		int Expointerress(word &pointer);	//表达式文法 
		int B(word &pointer); 		//
		
};

四元式结构体：

<img src="C:\Users\Chen Yining\AppData\Roaming\Typora\typora-user-images\image-20200704001931657.png" alt="image-20200704001931657" style="zoom:50%;" />

**二、遇到的问题**

1、最主要的问题其实还是出在语义动作的设计以及翻译文法的设计方面，对于文法的设计是由我们三个人共同完成的，但翻译文法的设计是属于我负责的语义分析模块中的一部分，也可以说是最重要的一部分，只有先确定好了翻译文法，才可以根据这个文法来继续做下去，否则是没有方向的。但对于翻译文法的设计，实际上我每一天都在完善和改动，因为总会有一些没有想到的漏洞，并且通过和队友讨论，我还可以发现已经设计好了的动作存在的问题，进行及时改动。

2、第二个问题在于生成四元式的设计以及错误分析，生成四元式包括if语句，while语句等等，后面接表达式的部分，首先需要查符号表，然后才可以确定四元式，同时四元式的生成是一个动态的语义栈的压栈和弹栈的过程，很繁琐。同时，错误分析需要考虑的方面也比较多，比如错误分析包括：数组定义的时候，元素序号必须是整型元素，赋值语句中的标识符必须是已经定义好了的，说明语句中的标识符必须是没有存在相同名称的等。
3、遇到的问题还包括对语义分析整个流程的设计，主要采用了递归下降子程序方法来进行分析，自顶向下进行递归调用，同时对每个函数的返回值作宏处理，返回0和1两种，以便进行递归的报错，同时对于每种不同的函数，报错结果不同，以便进行调试。

4、最关键的问题在于对前端所有模块的整合，这个工作是从7.3开始的， 首先遇到了扫描器，符号表以及语义分析的元素重定义和未定义的问题，同时遇见了编译器的未知bug（玄学！），我会努力争取在周末完成前端调试。

**三、个人阶段总结**：

编译原理课程设计对于我来讲，是我来到计算机这一年内做过最难的一次课设了。但是我认为是最有意义的一次。首先这次是通过github来维护项目的，对于我这样一个之前只用github浏览别人的开源项目的人，无疑是一次挑战。通过查找和学习，我可以完成相关的操作，对组内github维护等等，但是要做的还不够。其次，编译原理课设是对之前理论内容的一次实践，无论是前端还是后端，都可以对知识进行更好的掌握。虽然过程很难，但是希望可以完成的很好。

